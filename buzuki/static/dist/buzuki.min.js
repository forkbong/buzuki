"use strict";(()=>{const e=document.getElementById("autocomplete"),t=document.getElementById("search-input");let n=null;const o=()=>{e.style.left=t.offsetLeft+"px",e.style.top=t.offsetTop+t.offsetHeight-2+"px",e.style.minWidth=t.offsetWidth+"px"},i=(e,n=!0)=>{if(!e)return;const o=document.querySelector("li.selected");o&&o.classList.remove("selected"),e.classList.add("selected"),n&&(t.value=e.innerText)},s=()=>{clearTimeout(n);const o=t.value.replace(/[!@#$%^&*()\-_=+'"\s]+/gu," ").trim();if(!o.length)return e.innerHTML="",void(e.style.display="none");n=setTimeout(()=>{fetch("/api/autocomplete/?q="+o).then(e=>e.json()).then(t=>{if(!t.length)return e.innerHTML="",void(e.style.display="none");const n=[];t.forEach(e=>{n.push(`<li data-url="${e.url}">${e.name}</li>`)}),e.innerHTML=n.join(""),e.style.display="block"})},200)};window.addEventListener("resize",()=>{o()}),document.addEventListener("click",()=>{e.style.display="none"}),t.addEventListener("click",e=>{e.stopPropagation()}),t.addEventListener("input",()=>{s()}),t.addEventListener("focus",()=>{"block"!==e.style.display&&(o(),s())}),e.addEventListener("click",t=>{i(t.target),window.location.href=t.target.getAttribute("data-url"),e.remove()}),e.addEventListener("mouseover",e=>{i(e.target,!1)}),t.addEventListener("keyup",n=>{let o=document.querySelector("li.selected");switch(n.which){case 38:o=o&&o.previousElementSibling?o.previousElementSibling:document.querySelector("ul#autocomplete>li:last-child"),i(o);break;case 40:o=o&&o.nextElementSibling?o.nextElementSibling:document.querySelector("ul#autocomplete>li:first-child"),i(o);break;case 13:e.style.display="none",o?window.location.href=o.getAttribute("data-url"):t.value.length&&(window.location.href="/search/?q="+t.value)}})})(),(()=>{const e=document.querySelector(".cookiealert"),t=document.querySelector(".acceptcookies");if(!e)return;(e=>{const t=decodeURIComponent(document.cookie).split(";");for(let n=0;n<t.length;n+=1){const o=t[n].trim(),i=e+"=";if(0===o.indexOf(i))return o.substring(i.length,o.length)}return""})("consent")||e.classList.add("show"),t.addEventListener("click",()=>{((e,t,n)=>{const o=new Date,i=24*n*60*60*1e3;o.setTime(o.getTime()+i),document.cookie=`${e}=${t}; expires=${o.toUTCString()}; path=/`})("consent",!0,365),e.classList.remove("show")})})();const playlistsInit=(e,t)=>{addEventListeners(".custom-control,.custom-select","click",e=>{e.stopPropagation()});const n={"X-CSRFToken":t,Accept:"application/json","Content-Type":"application/json"},o=(t,o=null)=>{const i={slug:e,root:o};fetch(`/api/playlists/${t}/songs/`,{method:"post",headers:n,body:JSON.stringify(i)})};addEventListeners(".playlist-checkbox","change",t=>{const i=t.target,s=document.getElementById("root-"+i.id),l=i.getAttribute("data-playlist-slug");i.checked?(o(l),s.style.display="block"):((t=>{const o={slug:e};fetch(`/api/playlists/${t}/songs/${e}`,{method:"delete",headers:n,body:JSON.stringify(o)})})(l),s.style.display="none")}),addEventListeners(".playlist-root","change",e=>{const t=e.target,n=t.getAttribute("data-playlist-slug");let i=t.value;"-"===i&&(i=null),o(n,i)})};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{e.active&&console.log("Service worker is active")})});const transposeInit=(e,t,n)=>{const o=(e,t)=>{document.getElementById(e).innerHTML=t},i=e=>{const t=document.getElementById("logout");if(t){const n=t.getAttribute("href").split("=");n[1]=e,t.setAttribute("href",n.join("="))}};addEventListeners(".transpose-dropdown-item","click",s=>{const l=s.target.getAttribute("data-root");if(fetch(`${e}/${l}`).then(e=>e.json()).then(e=>{o(n,e.info),e.title&&o("header-title",e.title);let t=window.location.pathname.split("/");t=["",t[1],t[2],l];const s=t.join("/");window.history.pushState(null,"",s),i(s)}),t){const e=document.getElementById("save-button"),n=document.getElementById("print-button");e.removeAttribute("hidden"),e.setAttribute("href",`/admin/save/${t}/${l}`),n.setAttribute("href",`/songs/${t}/${l}/print`)}}),window.onpopstate=s=>{const l=window.location.pathname;i(l);const r=l.split("/")[3];if(fetch(`${e}/${r}`).then(e=>e.json()).then(e=>{o(n,e.info),e.title&&o("header-title",e.title)}),s.preventDefault(),t){const e=document.getElementById("save-button"),n=document.getElementById("print-button");r?(e.removeAttribute("hidden"),e.setAttribute("href",`/admin/save/${t}/${r}`),n.setAttribute("href",`/songs/${t}/${r}/print`)):e.setAttribute("hidden",!0)}}},addEventListeners=(e,t,n)=>{document.querySelectorAll(e).forEach(e=>{e.addEventListener(t,n)})};